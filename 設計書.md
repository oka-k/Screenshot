## 自動スクリーンショットアップローダー 設計書

### 1. 概要

本プログラムは、Windows PC上でバックグラウンドで動作し、定期的にスクリーンショットを撮影するツールです。撮影した画像ファイルは、**日付**と**PCのユーザー名**を基に自動で命名され、指定されたクラウドサービス（SlackまたはGoogleドライブ）にアップロードされます。

従業員は配布された単一の実行可能ファイル（`.exe`）を実行するのみで、一切の設定や認証操作を必要としません。

---

### 2. 機能要件

- FR-1: 定期的なスクリーンショット撮影
    
    設定された時間間隔（分単位）で、PCのプライマリスクリーンの全体を撮影します。撮影した画像はPNG形式で一時的にローカルに保存します。
    
- FR-2: ファイル命名規則
    
    ファイル名は YYYYMMDD-ユーザー名.png の形式を基本とします。YYYYMMDDは日本標準時（JST）の日付とし、ユーザー名はプログラムを実行しているWindowsのログインユーザー名を自動取得します。
    
- FR-3: ファイル名の重複回避
    
    FR-2で生成したファイル名がローカルに既に存在する場合、ファイルの上書きを避けるため、ファイル名の末尾に時刻 (_HHMMSS) などを付与して一意性を担保します。例: 20250825-MyUser_113347.png
    
- FR-4: 外部サービス連携
    
    撮影した画像ファイルを、以下のいずれかのサービスに自動でアップロードします。（実装時にどちらかを選択）
    
    - **A) Slack**: 指定されたチャンネルに画像ファイルを直接投稿します。
    - **B) Googleドライブ**: 指定されたフォルダに画像ファイルを直接アップロードします。
- FR-5: バックグラウンド実行
    
    実行時にコンソールウィンドウ（黒い画面）を表示せず、バックグラウンドプロセスとして動作します。
    

---

### 3. 技術仕様

### 3.1. 開発言語

**Python 3.9以上**を使用します。これは、タイムゾーンを扱う標準ライブラリ `zoneinfo` が利用できるためです。

### 3.2. 使用ライブラリ

- Pillow
    
    スクリーンショットの撮影と画像ファイルとしての保存に使用します。インストールコマンドは pip install Pillow です。
    
- schedule
    
    「N分ごと」といった定期的なタスク実行のスケジューリングに使用します。インストールコマンドは pip install schedule です。
    
- pyautogui
    
    Pillowの機能を利用してスクリーンショットを撮影するための高レベルなインターフェースとして使用します。インストールコマンドは pip install pyautogui です。
    
- requests
    
    【Slack連携時】Slack APIへのHTTPリクエスト（ファイルアップロード）に使用します。インストールコマンドは pip install requests です。
    
- google-api-python-client, google-auth-httplib2, google-auth-oauthlib
    
    【Googleドライブ連携時】Google Drive APIとの認証および通信に使用します。インストールは pip install google-api-python-client google-auth-httplib2 google-auth-oauthlib で行います。
    

### 3.3. 設定定数

スクリプトの先頭で、以下の定数を定義し、コンパイル前に設定します。

```python
# --- 共通設定 ---
# 撮影間隔（分）
INTERVAL_MINUTES = 5

# --- Slack連携用設定 ---
# Slack APIのボットトークン
SLACK_BOT_TOKEN = "xoxb-xxxxxxxxxxxx-xxxxxxxxxxxxx-xxxxxxxxxxxxxxxxxxxxxxxx"
# 投稿先のSlackチャンネルID
SLACK_CHANNEL_ID = "C0XXXXXXXXX"

# --- Googleドライブ連携用設定 ---
# サービスアカウントのJSONキーファイル名
SERVICE_ACCOUNT_FILE = 'your-key-file.json'
# アップロード先のGoogleドライブフォルダID
GDRIVE_FOLDER_ID = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'

```

---

### 4. プログラム構造（擬似コード）

```python
# 1. ライブラリのインポート
import os
import time
from datetime import datetime
from zoneinfo import ZoneInfo
import schedule
import pyautogui
# (requests または googleapiclient などをインポート)

# 2. 設定定数の定義
# (上記3.3の定数を定義)

# 3. メイン処理関数
def take_and_process_screenshot():
    # 3.1. ファイル名の生成 (FR-2, FR-3)
    username = os.getlogin()
    jst_now = datetime.now(ZoneInfo("Asia/Tokyo"))
    base_name = f"{jst_now.strftime('%Y%m%d')}-{username}"
    file_name = f"{base_name}.png"

    # 重複チェックロジック
    if file_exists(local_temp_path + file_name):
        timestamp_suffix = jst_now.strftime('%H%M%S')
        file_name = f"{base_name}_{timestamp_suffix}.png"

    local_file_path = local_temp_path + file_name

    # 3.2. スクリーンショット撮影 (FR-1)
    screenshot = pyautogui.screenshot()
    screenshot.save(local_file_path)

    # 3.3. 外部サービスへのアップロード (FR-4)
    # A) Slack連携の場合
    upload_to_slack(local_file_path, file_name, username)
    # B) Googleドライブ連携の場合
    # upload_to_gdrive(local_file_path, file_name)

    # 3.4. (任意) ローカルの一時ファイルを削除
    os.remove(local_file_path)

# 4. 外部連携の関数
def upload_to_slack(path, name, user):
    # requestsライブラリを使用
    # headersにSLACK_BOT_TOKENを含めて認証
    # files.upload APIにPOSTリクエストを送信
    pass

def upload_to_gdrive(path, name):
    # googleapiclientライブラリを使用
    # SERVICE_ACCOUNT_FILEを読み込んで認証
    # Drive API v3のserviceオブジェクトを構築
    # files().createメソッドでGDRIVE_FOLDER_IDを親としてファイルをアップロード
    pass

# 5. スケジューリングとメインループ
if __name__ == '__main__':
    # スケジュールを設定
    schedule.every(INTERVAL_MINUTES).minutes.do(take_and_process_screenshot)

    # プログラム起動時に一度実行
    take_and_process_screenshot()

    # 無限ループでスケジュールを実行し続ける
    while True:
        schedule.run_pending()
        time.sleep(1)

```

---

### 5. パッケージングと配布

### 5.1. パッケージングツール

PyInstaller を使用します。

インストールコマンド: pip install pyinstaller

### 5.2. コマンド

以下のコマンドを実行し、単一の実行可能ファイル（`.exe`）を生成します。

- **共通コマンド**
    
    ```bash
    pyinstaller --onefile --windowed --name "AutoScreenshotTool.exe" your_script_name.py
    ```
    
    - `-onefile`: 依存関係を全て1つの`.exe`にまとめます。
    - `-windowed`: 実行時にコンソールウィンドウを表示しません (FR-5に対応)。
- Googleドライブ連携時の追加オプションBash
    
    サービスアカウントのJSONキーファイルを同梱するため、--add-dataオプションを追加します。
        ```bash
    pyinstaller --onefile --windowed --name "AutoScreenshotTool.exe" --add-data "your-key-file.json;." your_script_name.py
    ```